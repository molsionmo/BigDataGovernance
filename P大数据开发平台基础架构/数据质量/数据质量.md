# 全链路监控平台

支持多种异构数据源的数据质量监控、任务监控、通知与管理平台

## 数据全链路监控模块

提供全链路的数据质量方案，包括数据探查、数据质量监控、SQL扫描和智能报警等功能。数据质量监控可全程监控数据加工流水线，根据质量规则及时发现问题，通过报警通知负责人及时处理。

数据质量以数据源为监控对象。计划支持离线数据表与实时数据流监控，数据质量监控模块将对数据进行校验，并会根据配置的规则进行报警或阻断任务。同时，数据质量监控模块还提供历史校验结果管理，以便您对数据质量进行分析和定级.

### 质量保障原则

* 完整性
  * 完整性是指数据的记录和信息是否完整，是否存在数据缺失情况。例如，某个稳定业务的数据量每天约为100万条记录，某天突然下降了1万条，则可能是出现了记录缺失。例如，某科高考成绩表中，每个考卷分数都对应一个准考证号，当准考证号字段的空值数大于0时，则可能是出现了信息缺失。
  * 银行提交的监管信息中必须带有贷款客户个人基本信息与紧急联系人等(中心化方案)
  * 监听数据库的变更数据时,变更记录的抓取条数应该与事实中的条数在量级上不能有很大差距(暂无方案)
* 准确性
  * 准确性是指数据中记录的信息和数据是否准确、是否存在异常或者错误的信息。例如，成绩单中分数出现负数或订单中出现错误的买家信息等，这些数据都是问题数据。确保记录的准确性也是保证数据质量必不可少的一部分。
* 及时性
  * 保障数据的及时产出才能体现数据的价值。例如，决策分析师通常希望当天就可以看到前一天的数据。若等待时间过长，数据失去了及时性的价值，数据分析工作将失去意义。
* 一致性
  * 一致性通常体现在跨度很大的数据仓库中。 例如，某公司有很多业务数仓分支，对于同一份数据，在不同的数仓分支中必须保证一致性。例如，从在线业务库加工到数据仓库，再到各个数据应用节点，用户ID必须保持同一种类型，且长度也要保持一致。

### 目的

* 提前感知数据完整性准确性及时性给数据应用的致命破坏, 保护数据应用
* 提前感知数据完整性准确性及时性给后续数据资产带来的损失,及时止损

### 业务线需求情况

1. 营销等辅助性业务应用场景是没有阻断需求的,有skip,告警需求
2. 风控等核心交易性相关业务场景需要skip,告警,阻断

### 基础概念

* 数据源: 数据源头,存储数据的位置
  * 订阅数据源: 用户订阅数据源, 用户将得到数据源的数据质量报告告警
* 数据应用场景: 不同的数据源有不同的应用场景,不同的应用场景对数据质量要求与配置不一样,如淘宝数据,A场景只需要购买金额数据,B场景需要购买的物品数据
* 数据质量规则: 面向数据源与数据应用场景配置其质量规则
  * 规则-数据源
  * 规则-数据应用场景
    * 有对应的流任务或批量任务对应的场景,可以进行阻断或skip
    * 无对应的流任务或批量任务对应的场景,不允许阻断或skip,只允许告警
  * 规则-约束条件 *-1 行为配置(告警,skip,阻断)
    * 绘制用户流动位置图场景(有对应的任务), Id为空 | location为空 ,skip且告警(1小时内10条告警)
    * 整体校验淘宝数据可用性场景(无对应的任务), Amount为空 | Amount小于0 ,告警(1条即告警), BuyList为空 告警(1条即告警)
* 数据质量报告: 表示数据源根据质量规则配置按需进行校验得到的检验报告
  * 报告可以聚合数据源对应质量规则下的质量报告情况
  * 如{数据源A-质量规则1001(数据场景), 总1000条数据, 5条违反规则中约束条件1(条件说明) 数据详情:{}, 6条违反规则中约束条件2(条件说明) 数据详情:{}}

### 实时数据质量监控

#### 流程图

<img src="https://i.loli.net/2019/08/26/7n5Q1NJsL98USou.png" width = "700" height = "500" alt="建议数据质量执行流程图" align=center />

#### 组件图

**监控内嵌方式**

<img src="https://i.loli.net/2019/08/26/dY3ZL9htJFGUPxW.png" width = "50%" height = "50%" alt="内嵌监控方式组件图" align=center />

**监控隔离方式**

<img src="https://i.loli.net/2019/08/26/UZDrCKl1zwsR43b.png" width = "50%" height = "50%" alt="隔离监控方式组件图" align=center />

* 内嵌监控方式优势
  * 监控任务与实时执行任务消费的数据一致, 可以实时阻断与进行skip
* 内嵌监控方式劣势
  * 数据质量规则修改是需要重启核心任务的,不过频率应该较低(可以在用户修改质量时提示用户即可)
* 隔离监控优势
  * 监控任务与实际任务隔离,各不干扰
* 隔离监控劣势
  * 监控任务与实时执行任务消费的数据不一致,无法skip数据,阻断对应任务无法保证与实时任务数据一致

综合而言, 有对应的数据应用场景适合用内嵌监控方式, 面向数据源但是没有数据开发任务的应用场景适合用隔离监控

### 总结

* 数据源 + 数据场景 为一项数据质量定义, 数据质量面向数据场景; 同份数据源的不同应用场景配置不同质量
* 数据场景可以有对应的计算任务,实时或离线,也可以无对应的计算任务,单独负责. 无计算任务 如[用户淘宝数据完整性准确性]
* 支持多数据源的数据应用场景(暂无); 每个数据源都配置这个应用场景A的质量

## 任务全链路监控模块
